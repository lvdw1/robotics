<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from furuta_pendulum.urdf.xacro     | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<!-- modified from https://github.com/macstepien/furuta_pendulum/blob/master/furuta_pendulum_description/urdf/furuta_pendulum.urdf.xacro -->
<robot name="double_pendulum"> <!-- Renamed robot for clarity -->
  <material name="grey">
    <color rgba="0.5 0.5 0.5 1.0"/>
  </material>
  <material name="red"> <!-- Added a different color for the new link -->
      <color rgba="0.8 0.1 0.1 1.0"/>
  </material>

  <link name="world"/>
  <joint name="world_to_base_joint" type="fixed">
    <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
    <parent link="world"/>
    <child link="base_link"/>
  </joint>

  <link name="base_link">
    <visual>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0895"/>
      <geometry>
        <cylinder length="0.179" radius="0.025"/>
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0895"/>
      <geometry>
        <cylinder length="0.179" radius="0.025"/>
      </geometry>
    </collision>
    <inertial>
      <!-- Base inertia might represent the motor etc. Keep as is or refine -->
      <mass value="0.5"/> <!-- Adjusted mass for base link if needed -->
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
      <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01"/> <!-- Inertia related to J1 -->
    </inertial>
  </link>

  <joint name="joint0" type="revolute"> <!-- Base Rotation -->
    <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.184"/>
    <parent link="base_link"/>
    <child link="arm1"/>
    <axis xyz="0 0 1"/>
    <!-- Damping/friction for the actuated joint -->
    <dynamics damping="0.001"/> <!-- Example damping, adjust based on your model -->
    <!-- Limits for the actuated joint -->
    <limit effort="2.0" velocity="30.0"/> <!-- Use max_torque_joint0, max_velocity_joint0 from YAML -->
  </joint>

  <link name="arm1"> <!-- Rotating Arm holding the first pendulum -->
    <visual>
      <origin rpy="0.0 1.5707963267948966 0.0" xyz="0.0467625 0.0 0.0"/>
      <geometry>
        <cylinder length="0.093525" radius="0.005"/>
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin rpy="0.0 1.5707963267948966 0.0" xyz="0.0467625 0.0 0.0"/>
      <geometry>
        <cylinder length="0.093525" radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <!-- Represents m1, L1, J1_link (inertia of arm1 itself) from your parameters -->
      <!-- Note: Pinocchio often lumps rotating arm inertia with base inertia for joint0 -->
      <mass value="0.040466"/> <!-- m1 in dynamics equations (mass of rotating arm) -->
      <origin rpy="0.0 0.0 0.0" xyz="0.05415 0.0 0.0"/> <!-- CoM relative to joint0 -->
      <!-- Inertia about CoM (adjust if needed) -->
      <inertia ixx="1e-06" ixy="0.0" ixz="0.0" iyy="5.96237099e-05" iyz="0.0" izz="5.96237099e-05"/>
    </inertial>
  </link>

  <joint name="joint1" type="revolute"> <!-- First Pendulum Joint -->
    <!-- Origin at the end of arm1 -->
    <!-- The RPY rotates the child frame (arm2) so its Z-axis points down when angle is 0 -->
    <origin rpy="-1.57079632679 0.0 0.0" xyz="0.093525 0.0 0.0"/> <!-- Adjusted RPY maybe needed? Let's try common axis -->
    <!-- Let's keep RPY=0 0 0 and align arm2 along Z -->
    <!-- <origin rpy="0.0 0.0 0.0" xyz="0.093525 0.0 0.0"/> -->
    <parent link="arm1"/>
    <child link="arm2"/>
    <!-- Axis of rotation relative to parent (arm1). X-axis of arm1 frame -->
    <axis xyz="1 0 0"/>
    <!-- Dynamics for the unactuated joint -->
    <dynamics damping="1e-5"/> <!-- Example damping (viscous friction) -->
    <!-- Limits (velocity limit is physical, effort limit often ignored for unactuated) -->
    <limit effort="0.0" velocity="30.0"/> <!-- Use max_velocity_joint1 -->
  </joint>

  <link name="arm2"> <!-- First Pendulum Link -->
    <visual>
       <!-- Cylinder aligned along Z axis of arm2's frame, centered at CoM -->
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0645"/> <!-- Centered at CoM -->
      <geometry>
        <cylinder length="0.129" radius="0.005"/> <!-- L2 = 0.129? Or is CoM at 0.096? Let's assume length is 0.129 -->
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0645"/> <!-- Match visual -->
      <geometry>
        <cylinder length="0.129" radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <!-- Represents m2, L2 (CoM dist), J2 from your parameters -->
      <mass value="0.009801"/> <!-- m2 -->
      <!-- Origin of inertia frame = CoM relative to joint1 origin -->
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.096608"/> <!-- CoM (L2 in dynamics equations) -->
      <!-- Inertia tensor about CoM -->
      <inertia ixx="1.479e-05" ixy="0.0" ixz="0.0" iyy="1.479e-05" iyz="0.0" izz="1e-06"/> <!-- J2 components -->
    </inertial>
  </link>

  <!-- ********** NEW JOINT and LINK START ********** -->

  <joint name="joint2" type="revolute"> <!-- Second Pendulum Joint -->
    <!-- Origin at the end of arm2. arm2 has length 0.129, its origin is at joint1. -->
    <!-- So, the end is at 0,0,0.129 relative to arm2's frame -->
    <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.129"/>
    <parent link="arm2"/>
    <child link="arm3"/>
    <!-- Axis of rotation relative to parent (arm2). -->
    <!-- Assuming it swings in the same plane as joint1. joint1 axis was X in arm1 frame. -->
    <!-- What is the orientation of arm2 frame? depends on joint1 rpy. -->
    <!-- If joint1 rpy was 0,0,0 then arm2 X points along arm1, arm2 Y points ?, arm2 Z points out? -->
    <!-- If joint1 rpy was -pi/2,0,0 then arm2 Z points down, Y points along arm1 axis, X points ? -->
    <!-- Let's assume axis should be relative to arm2's X axis -->
    <axis xyz="1 0 0"/>
    <!-- Dynamics for the second unactuated joint -->
    <dynamics damping="1e-5"/> <!-- Example damping -->
    <!-- Limits -->
    <limit effort="0.0" velocity="30.0"/> <!-- Use max_velocity_joint2 -->
  </joint>

  <link name="arm3"> <!-- Second Pendulum Link -->
    <visual>
      <!-- Let's make it slightly shorter, e.g., length 0.1 -->
      <!-- Centered at CoM (assuming CoM is at L3/2 = 0.05) -->
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.05"/>
      <geometry>
        <cylinder length="0.1" radius="0.005"/>
      </geometry>
      <material name="red"/> <!-- Use different color -->
    </visual>
    <collision>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.05"/> <!-- Match visual -->
      <geometry>
        <cylinder length="0.1" radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <!-- Represents m3, L3 (CoM dist), J3 from your parameters -->
      <mass value="0.007"/> <!-- m3 - Example value -->
      <!-- Origin of inertia frame = CoM relative to joint2 origin -->
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.05"/> <!-- CoM (L3 in dynamics equations) -->
      <!-- Inertia tensor about CoM - Estimate for thin cylinder m=0.007, L=0.1, r=0.005 -->
      <!-- Ixx=Iyy = 1/12*m*L^2 + 1/4*m*r^2 ~= 5.9e-6 -->
      <!-- Izz = 1/2*m*r^2 ~= 8.8e-8 -->
      <inertia ixx="5.9e-6" ixy="0.0" ixz="0.0" iyy="5.9e-6" iyz="0.0" izz="1e-7"/> <!-- J3 components -->
    </inertial>
  </link>

  <!-- ********** NEW JOINT and LINK END ********** -->


  <!-- ********** UPDATED END EFFECTOR JOINT ********** -->
  <joint name="end_effector_joint" type="fixed">
    <!-- Origin at the end of arm3. arm3 has length 0.1, CoM at 0.05 -->
    <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.1"/>
    <!-- Parent is now arm3 -->
    <parent link="arm3"/>
    <child link="end_effector"/>
  </joint>
  <!-- ********** END EFFECTOR JOINT UPDATED ********** -->

  <link name="end_effector">
    <!-- This link is often just used as a frame marker -->
  </link>
</robot>
